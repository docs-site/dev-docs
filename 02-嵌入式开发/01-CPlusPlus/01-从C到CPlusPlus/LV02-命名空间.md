---
title: LV02-命名空间
date: 2025-07-11 11:36:39
icon: famicons:logo-markdown
index: true
tags:
categories:
---

了解一下C++的命名空间。

<!-- more -->

## 一、命名空间的引入

### 1. 出现冲突

一个中大型软件往往由多名程序员共同开发，会使用大量的变量和函数，不可避免地会出现变量或函数的命名冲突。当所有人的代码都测试通过，没有问题时，将它们结合到一起就有可能会出现命名冲突。

例如小李和小韩都参与了一个文件管理系统的开发，它们都定义了一个全局变量 fp，用来指明当前打开的文件，将他们的代码整合在一起编译时，很明显编译器会提示 fp 重复定义（Redefinition）错误。

为了解决合作开发时的命名冲突问题，C++ 引入了命名空间（Namespace）的概念。请看下面的例子：

```c++
namespace Li{  //小李的变量定义
    FILE* fp = NULL;
}

namespace Han{  //小韩的变量定义
    FILE* fp = NULL;
}
```

小李与小韩各自定义了以自己姓氏为名的命名空间，此时再将他们的 fp 变量放在一起编译就不会有任何问题。

### 2.基本格式

命名空间有时也被称为名字空间、名称空间。namespace 是C++中的关键字，用来定义一个命名空间，语法格式为：

```c++
namespace name{
    //variables, functions, classes
}
```

name是命名空间的名字，它里面可以包含变量、函数、类、typedef、#define 等，最后由{ }包围。

### 3. 怎么使用？

#### 3.1 `::` 域解析操作符

使用变量、函数时要指明它们所在的命名空间。以上面的 fp 变量为例，可以这样来使用：

```c++
Li::fp = fopen("one.txt", "r");     // 使用小李定义的变量 fp
Han::fp = fopen("two.txt", "rb+");  // 使用小韩定义的变量 fp
```

`::`是一个新符号，称为域解析操作符，在C++中用来指明要使用的命名空间。

#### 3.2 using 声明 

##### 3.2.1 具体成员

除了直接使用域解析操作符，还可以采用 using 关键字声明，例如：

```c++
using Li::fp;
fp = fopen("one.txt", "r");  //使用小李定义的变量 fp
Han :: fp = fopen("two.txt", "rb+");  //使用小韩定义的变量 fp
```

在代码的开头用using声明了 Li::fp，它的意思是，using 声明以后的程序中如果出现了未指明命名空间的 fp，就使用 Li::fp；但是若要使用小韩定义的 fp，仍然需要 Han::fp。

##### 3.2.2 整个命名空间

using 声明不仅可以针对命名空间中的一个变量，也可以用于声明整个命名空间，例如：

```c++
using namespace Li;
fp = fopen("one.txt", "r");  //使用小李定义的变量 fp
Han::fp = fopen("two.txt", "rb+");  //使用小韩定义的变量 fp
```

如果命名空间 Li 中还定义了其他的变量，那么同样具有 fp 变量的效果。在 using 声明后，如果有未具体指定命名空间的变量产生了命名冲突，那么默认采用命名空间 Li 中的变量。

### 4. 命名空间有哪些内容？

命名空间内部不仅可以声明或定义变量，对于其它能在命名空间以外声明或定义的名称，同样也都能在命名空间内部进行声明或定义，例如类、函数、typedef、#define 等都可以出现在命名空间中。

站在编译和链接的角度，代码中出现的变量名、函数名、类名等都是一种符号（Symbol）。有的符号可以指代一个内存位置，例如变量名、函数名；有的符号仅仅是一个新的名称，例如 typedef 定义的类型别名。

## 二、C++头文件和std命名空间

### 1. 发展情况

C++ 是在C语言的基础上开发的，早期的 C++ 还不完善，不支持命名空间，没有自己的编译器，而是将 C++ 代码翻译成C代码，再通过C编译器完成编译。这个时候的 C++ 仍然在使用C语言的库，stdio.h、stdlib.h、string.h 等头文件依然有效；此外 C++ 也开发了一些新的库，增加了自己的头文件，例如：

- iostream.h：用于控制台输入输出头文件。
- fstream.h：用于文件操作的头文件。
- complex.h：用于复数计算的头文件。

和C语言一样，C++ 头文件仍然以`.h`为后缀，它们所包含的类、函数、宏等都是全局范围的。后来 C++ 引入了命名空间的概念，计划重新编写库，将类、函数、宏等都统一纳入一个命名空间，这个命名空间的名字就是`std`。std 是 standard 的缩写，意思是“标准命名空间”。但是这时已经有很多用老式 C++ 开发的程序了，它们的代码中并没有使用命名空间，直接修改原来的库会带来一个很严重的后果：程序员会因为不愿花费大量时间修改老式代码而极力反抗，拒绝使用新标准的 C++ 代码。

C++ 开发人员想了一个好办法，保留原来的库和头文件，它们在 C++ 中可以继续使用，然后再把原来的库复制一份，在此基础上稍加修改，把类、函数、宏等纳入命名空间 std 下，就成了新版 C++ 标准库。这样共存在了两份功能相似的库，使用了老式 C++ 的程序可以继续使用原来的库，新开发的程序可以使用新版的 C++ 库。

为了避免头文件重名，新版 C++ 库也对头文件的命名做了调整，去掉了后缀`.h`，所以老式 C++ 的`iostream.h`变成了`iostream`，`fstream.h`变成了`fstream`。而对于原来C语言的头文件，也采用同样的方法，但在每个名字前还要添加一个`c`字母，所以C语言的`stdio.h`变成了`cstdio`，`stdlib.h`变成了`cstdlib`。

> 需要注意的是，旧的 C++ 头文件是官方所反对使用的，已明确提出不再支持，但旧的C头文件仍然可以使用，以保持对C的兼容性。实际上，编译器开发商不会停止对客户现有软件提供支持，可以预计，旧的 C++ 头文件在未来数年内还是会被支持。

可以发现，对于不带`.h`的头文件，所有的符号都位于命名空间 std 中，使用时需要声明命名空间 std；对于带`.h`的头文件，没有使用任何命名空间，所有符号都位于全局作用域。这也是 C++ 标准所规定的。

### 2. 现实情况？

现实情况和 C++ 标准所期望的有些不同，对于原来C语言的头文件，即使按照 C++ 的方式来使用，即`#include `这种形式，那么符号可以位于命名空间 std 中，也可以位于全局范围中，可以看下面的两段代码。

- （1）使用命名空间 std：

```c++
#include <cstdio>
int main()
{
    std::printf("hello world!\n");
    return 0;
}

```

- （2）不使用命名空间 std：

```c++
#include <cstdio>

// 这是一种非标准写法，可能会在以后的升级版本中不再支持。
int main()
{
    printf("hello world!\n");
    return 0;
}
```

这两种形式在GCC下都能够编译通过，也就是说，大部分编译器在实现时并没有严格遵循C++标准，它们对两种写法都支持，我们可以使用 std 也可以不使用。

但是使用命名空间这种写法是标准的，不使用命名空间这种写法不标准，虽然它们在目前的编译器中都没有错误，但还是推荐使用第 （1) 种写法，因为标准写法会一直被编译器支持，非标准写法可能会在以后的升级版本中不再支持。

### 3. 使用C++的头文件

虽然 C++ 几乎完全兼容C语言，C语言的头文件在 C++ 中依然被支持，但 C++ 新增的库更加强大和灵活，但还是尽量使用这些 C++ 新增的头文件，例如 iostream、fstream、string 等。

下面的例子演示了如何使用 C++ 库进行输入输出：

```c++
#include <iostream>
#include <string>

// 前面我们使用了C语言的格式输出函数 printf，引入了C语言的头文件 stdio.h，
// 将C代码和 C++ 代码混合在了一起，但其实不推荐这样做，还是需要尽量使用 C++ 的方式。
int main()
{
    // 声明命名空间std
    using namespace std;

    // 定义字符串变量
    string str;
    // 定义 int 变量
    int age;
    // 从控制台获取用户输入
    cout << "请输入名字和年龄, 中间用空格隔开:" << endl;
    cin >> str >> age;
    // 将数据输出到控制台
    cout << str << "已经" << age << "岁了!" << endl;
    return 0;
}
```

string 是 C++ 中的字符串类，一开始我们可以将 string 看做一种内置的数据类型，就像 int、float 等，可以用来定义变量。cin 用于从控制台获取用户输入，cout 用于将数据输出到控制台，后面会详细学习。`using namespace std;`，它声明了命名空间 std，后续如果有未指定命名空间的符号，那么默认使用 std，代码中的 string、cin、cout 都位于命名空间 std。

### 4. 命名空间声明

在 main() 函数中声明命名空间 std，它的作用范围就位于 main() 函数内部，如果在其他函数中又用到了 std，就需要重新声明，可以看下面的例子：

```c++
#include <iostream>
void func()
{
    // 必须重新声明
    using namespace std;
    cout << "This is func!" << endl;
}

int main()
{
    // 声明命名空间std
    using namespace std;
    cout << "Ths is main!" << endl;
    func();
    return 0;
}
```

如果希望在所有函数中都使用命名空间 std，可以将它声明在全局范围中，例如：

```c++
#include <iostream>
// using namespace std; // 声明命名空间,全局声明的话，就不需要在每个部分都添加声明了
void func()
{
    cout << "This is func!" << endl;
}

int main()
{
    cout << "Ths is main!" << endl;
    func();
    return 0;
}
```

注意：将 std 直接声明在所有函数外部，这样虽然使用方便，但在一些中大型项目开发中是不被推荐的，这样做增加了命名冲突的风险，一般还是推荐在函数内部声明 std 或者直接使用`::`域解析操作符。